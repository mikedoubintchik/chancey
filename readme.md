# Chancey

## Prep environment
You can do this all in one go (except #4) by running `npm run setup`

1. Install Firebase CLI `npm install -g firebase-tools`
2. Install SDKMAN `curl -s "https://get.sdkman.io" | bash`
3. Install JAVA `sdk install java 11.0.2-open`
4. Set correct path to
5. Install RVM `\curl -sSL <https://get.rvm.io> | bash -s stable --ruby`
6. Install NVM `curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.2/install.sh | bash`
7. Add below environment variable to your shell .rc file (~/.zshrc or ~/.bashrc)


```sh
# JAVA & Android
export JAVA_HOME=$(/usr/libexec/java_home -v 1.8)
export ANDROID_SDK_ROOT=$HOME/Library/Android/sdk
export ANDROID_HOME=$HOME/Library/Android/sdk
export PATH=$PATH:$ANDROID_HOME/emulator
export PATH=$PATH:$ANDROID_HOME/tools
export PATH=$PATH:$ANDROID_HOME/tools/bin
export PATH=$PATH:$ANDROID_HOME/platform-tools

# Fastlane
export LC_ALL=en_US.UTF-8
export LANG=en_US.UTF-8
```

## Running the app

```sh
# start local dev server
npm start

# run ios emulator
npm run start:ios

# run android emulator (NOTE: emulator must already be running)
npm run start:android

# run prod version served through firebase
npm run build
npm run start:prod # go to localhost:8081
```

## iOS

- [Setup](https://ionicframework.com/docs/developing/ios)
- [Debugging](https://ionicframework.com/docs/developing/ios#debugging-ios-apps)
- [Viewing Native Logs](https://ionicframework.com/docs/developing/ios#viewing-native-logs)

## Android

- [Setup](https://ionicframework.com/docs/developing/android)
- [Debugging](https://ionicframework.com/docs/developing/android#debugging-android-apps)
- [Viewing Native Logs](https://ionicframework.com/docs/developing/android#viewing-native-logs)

## Emulating Firebase Functions

See Emulator UI at `http://localhost:4000/`

```sh
# run firebase emulator
npm run functions:emulate

# run emulator and watch for changes to code
npm run functions:watch
```


## Development

- [Detecting Platform](https://ionicframework.com/docs/core-concepts/cross-platform#platform-detection)
- Add your debug token to [AppCheck](https://console.firebase.google.com/project/tune-363401/appcheck/apps) -- you can find it in the console logs

## Deployment

```sh
# deploy to hosting
npm run deploy
```

## Push Notifications
You can test push notifications from Postman using the Legacy API or from the Firebase Console.
- See collection in the postman folder
- See [Firebase Console](https://console.firebase.google.com/project/tune-363401/notification/compose)

Notes (if using Postman):
- Make sure to replace the `to` in the body with the token generated by your applications (see console logs).
- Authorization key comes from [Server Key on Legacy API](https://console.firebase.google.com/project/tune-363401/settings/cloudmessaging) -- Should only have to be set once and used only for test. For production, Firebase Functions should be sending push notifications via new FCM API.

## Troubleshoot

### Errors when running `firebase deploy`

These usually have to do with firebase functions issues. To debug those run `firebase functions:log`. In most cases, that will show you the issue.